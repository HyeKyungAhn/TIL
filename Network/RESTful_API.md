# RESTful API

## REST(Representational State Transfer)란?

아키텍처 스타일이다. 엄격하게는 Roy Fielding이 제시한 6가지의 제약조건을 만족하는 것을 RESTful이라고 말한다.(통신 프로토콜을 정해놓지도 않는다) 하지만 요즘의 REST 하다는 말은 느슨하게 'HTTP 기반의 API'를 의미하곤 한다. HTTP를 통해 서버와 클라이언트가 JSON 형식의 데이터를 전송하는 API라고도 말할 수 있다.

## 6가지 제약조건

"REST" 스러움에 대해 배우려면 Roy Fielding이 제시한 제약조건을 알아야한다. 한가지는 옵션이기는 하다.

### 1. Uniform Interface

서버와 클라이언트 간에 통일된 인터페이스가 있어야한다. 인터페이스는 상호작용하기 위해 약속한 규칙, 통신 방식을 의미한다. RESTful api의 인터페이스는 HTTP method(GET, POST...), 자원을 식별하는 URI, HTTP 응답 상태코드 등을 포함한다. Uniform Interface를 만들고 사용하기위해서 4가지 원칙을 지켜야한다.

#### 1.1. 자원 기반(Resource-based)

자원(Resource)은 무엇을 이야기할까? **자원은 API에서 제공하는 서비스나 데이터**를 말한다. 예를 들어 게시판 기능을 제공하는 웹페이지에서의 자원은 게시글(post)이고 회원가입에서는 사용자(User)이다. 품사로 따지자면 명사에 해당하는 단어를 말한다. 자원은 추상적인 개념인데, 이런 모호한 자원을 식별할 때는 고유한 경로인 URI을 사용한다. 여러개의 URI가 같은 자원을 가리킬 수 있다. 이러한 자원이 어떻게 처리되야하는지에 대한 '행위'는 HTTP의 메서드로 표현된다.

#### 1.2. 'Representation'을 통한 자원 처리 (Manipulation of Resources Through Representation)

Representation은 무엇일까? 표현으로 번역하기에는 의미의 범위가 너무 넓기 때문에 영어 단어 그대로 사용하려고 한다. Representation은 추상적인 자원의 내용과 상태를 클라이언트와 서버가 이해할 수 있는 특정한 형식(JSON, XML)으로 표현하는 것을 말한다. 요청이나 응답의 body에 담겨 전달되는 특정 형식의 데이터를 말한다.

```
{
  "name": "Jane Doe",
  "email": "jane.doe@example.com"
}
```

예를 들어 사용자의 연락처를 제공하는 프로그램에서 Tom의 연락처를 얻으려고 할 때 자원, 서비스, Representation은 아래와 같다.

|                |                                  |
| -------------- | -------------------------------- |
| 자원           | User(Tom)                        |
| 서비스         | 연락처 제공(GET 메서드)          |
| Representation | 이메일, 전화번호, sns 계정, 주소 |

#### 1.3. 자기 설명적인 메시지(Self-descriptive Message)

각 요청 및 응답은 독립적이어야하기 때문에 처리하려는 작업에 대한 완전한 정보를 포함하고 있어야한다. 이때의 정보는 HTTP 메서드, 헤더, 상태코드, Representation, 링크, 관계 등을 포함한다. URI로는 자원을 식별하는 정보를 보내고, 응답 및 요청의 body에는 상태 정보를 포함해서 보낸다.

#### 1.4. Hypermedia as the Engine of Application State (HATEOAS)

클라이언트가 서버에서 응답에 포함된 하이퍼미디어 링크(하이퍼링크)를 통해 상태를 전이할 수 있다. 여기서 상태의 전이란, 클라이언트 애플리케이션의 상태를 변경하는 것이다. 페이지를 이동하는 것 뿐만 아니라, 클라이언트와 서버의 상호작용으로 자원을 검색하거나 추가, 수정, 삭제하면서 애플리케이션의 상태를 변화시키는 것을 말한다.

서버는 서비스의 추가나 변화에 대한 하이퍼링크를 동적으로 제공할 수 있고 클라이언트 측에서는 엔드 포인트를 모두 알고 있을 필요가 없으니 코드가 단순해진다.

### 2. 무상태성(Stateless)

**상태**란 무엇인가?
서버와 클라이언트간의 상호작용을 이해하기 위해서 필요한 정보이다. 상태 정보는 두 가지로 나뉜다.

1. 자원의 상태

   자원의 특정 시점의 데이터. 자원의 상태는 서버와 클라이언트 간에 representation으로 전달된다. 요청이나 클라이언트에 상관없이 자원의 상태는 일정하다.

2. 애플리케이션의 상태

   클라이언트에 의해 관리되는 상태. 클라이언트가 작업을 수행하는데 필요한 데이터를 말한다. 예를 들어 페이지 탐색 시, 페이지 정보(현재 페이지 번호, 검색 필터)등이
   애플리케이션 상태에 해당된다. 이 상태는 요청마다 클라이언트마다 달라질 수 있다.

RESTful api의 핵심적인 특징 중 하나는 무상태성(stateless)이다. 상태의 정보를 유지할 수 없기 때문에 각 요청과 응답이 독립적이어야 하며 작업을 처리하기 위해 필요한 상태와 완전한 정보를 포함해야한다(Self-descriptive message).

유투브에서 한 유저가 로그인을 한 후 여러 영상들을 보는 상황을 생각해보자. 유투브는 유저의 시청 기록을 바탕으로 복잡한 알고리즘을 사용해서 유저가 클릭할만한 영상의 목록을 제공한다. 유투브 서버는 A 유저가 영상을 클릭할 때마다 이 요청이 A 유저로부터 온 요청임을 식별할 수 있어야 A 유저에 대한 시청기록을 생성할 수 있다. 하지만 유투브 애플리케이션이 RESTful API로 설계되어 무상태라면 유투브는 A 유저가 하는 모든 요청에 대해 상태를 저장하지 않는다. 서버입장에서는 모든 요청이 다 새로운 요청이라는 의미이다. 그렇다면 서버에서 이 요청이 A유저로부터 온 요청이라는 것을 어떻게알 수 있을까? 요청에 필요한 상태정보를 다 포함해서 보내야 한다. (session을 통해 서버가 상태를 유지하는 방법도 있다.) 또 상태 정보가 여러 페이지에 걸쳐 있을 때는 페이지를 이동할 때마다 상태 정보를 재전송 해야한다.

무상태성에서 상태 정보를 매번 보내야한다면 요청 및 응답의 크기가 커진다는 단점도 있지만,서버가 상태를 유지, 업데이트, 전달 하지 않아도 되기 때문에 확장성이 커진다는 장점이 있다. 확장성은 서버의 부하, 사용자 요청의 증가를 효율적으로 처리할 수 있는 능력을 말한다.

### 3. 캐시 가능(Cacheable)

캐시란 요청에 대한 응답을 클라이언트나 프록시 서버에 저장해서 재요청 시 사용하기 때문에 서버에 대한 반복적인 요청을 줄일 수 있다. 클라이언트와 서버의 상호작용을 일부분 또는 완전히 제거할 수있다. 예를 들어 로고 이미지를 클라이언트에 캐싱한다면 웹 페이지 이동시마다 있는 로고는 서버에 재요청하지 않고도 캐싱된 파일을 받아 출력할 수 있다. 이는 상호작용을 이부분 제거한 예에 해당된다.

### 4. Client-Server

Uniform interface는 서버와 클라이언트를 분리시킨다. 서버는 유저 인터페이스나 코드를 신경쓰지 않아도 되기 때문에 코드는 더 심플해지고 (클라이언트 측의 코드가 빠지기 때문에) 같은 자원으로 더 많은 작업을 수행할 수 있게 되어 확장성이 커진다. 클라이언트도 서버의 구현을 모르고 서버측에서 제공하는 api만 사용하면 되기 때문에 이식성이 커진다. 서버 또는 클라이언트의 프로그램이 수정되거나 바뀌어도 인터페이스가 바뀌지 않는한 다른 한 편의 프로그램은 영향을 받지 않는다.

### 5. Layerd System

서버와 클라이언트 사이에 여러 계층이 존재할 수 있다는 의미이다. 중간계층에는 사용자의 요청을 분산시켜 서버 부하를 고르게 나누는 로드밸런서, 서버의 응답을 중간에 저장해서 서버와 클라이언트의 상호작용을 제거해서 서버의 부하를 줄이고 응답성을 향상시키는 캐시, 클라이언트의 요청을 서버에 전달하고 서버의 응답을 클라이언트에 전달해서 보안에 유용한 프록시서버, 여러 백엔드 API를 하나의 엔드포인트로 통합해서 클라이언트에 제공하는 게이트웨이가 올 수 있다.

### 6. Code on Demand(선택)

클라이언트에서 서버로부터 실행할 수 있는 코드를 다운로드 받고 서버에서 실행할 수 있도록 허용하는 것이다. 클라이언트의 기능을 일시적으로 확장하거나 사용자에 따라 기능을 추가한다고도 말할 수있다. Javascript 코드나 자바의 applet을 예시로 들수 있다. 클라이언트는 아무런 정보 없이 서버와 상호작용을 시작하되 필요할 때마다 코드를 다운로드받을 수 있기 때문에 경량화의 장점이 있고 서버에서는 프로그램의 업데이트에 부담을 가지지 않고 적절한 때 필요한 코드를 클라이언트에 제공할 수 있다는 장점이 있다.
