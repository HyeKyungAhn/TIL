# Chapter 2 - 네트워크 서비스와 애플리케이션 계층(TCP/IP 쉽게, 더 쉽게)

## 목차

0. [개관](##0._개관)
1. [애플리케이션 계층의 역할](#1-애플리케이션-계층의-역할)
2. [웹페이지를 전송하는 HTTP](#2-웹페이지를-전송하는-http)
3. [웹 서비스와 웹 애플리케이션(HTTP)](#3-웹서비스와-웹-애플리케이션http)
4. [세션을 유지하기 위한 쿠키(HTTP)](#4-세션을-유지하기-위한-쿠키http)
5. [이메일(SMTP, POP, IMAP)](#5-이메일)
6. [PC끼리 파일 공유하기(SMB, AFP)](#6-pc끼리-파일-공유하기)
7. [파일을 전송하는 FTP](#7-파일을-전송하는-ftp)
8. [원격지의 컴퓨터 제어하기(Telnet, SSH)](#8-원격지의-컴퓨터-제어하기)
9. [Voice over IP와 영상 스트리밍](#9-voice-over-ip와-영상-스트리밍)

## 0. 개관

- 애플리케이션 계층은 사용자가 직접 사용하며 체감할 수 있는 **서비스를 제공**한다
- 이 계층의 프로토콜은 서비스 제공을 위해 서버와 클라이언트 간 **다양한 메시지나 명령**을 주고 받게 함.
  - 서비스가 다르면 > 주고 받는 메시지나 명령이 다름 > 절차나 규약이 다르기에 프로토콜도 다름
- 서비스 별로 다른 프로토콜을 정의해 사용했지만 빠르게 변하는 요구사항을 반영하기 위해 더 짧은 시간, 더 적은 노력으로 개발, 개선할 수 있도록 기존의 **HTTP 프로토콜을 활용**하는 서비스를 (좁은 의미의)**웹 서비스**라고 한다.

### 계층이란

- 네트워크 통신에 참여하는 프로그램과 장비를 역할별로 분류하고 추상화한 것

### 프로토콜이란

- 네트워크 통신 시 절차나 규약
- 각 계층의 인터페이스(통신 절차, 규칙)과 상호작용을 결정함
  - 예: 데이터 포맷, 메시지 구조, 헤더나 트레일 형식, 통신 절차, 오류 처리방식 등

## 1. 애플리케이션 계층의 역할

- 사용자에게 **서비스 제공**
- 데이터 전송 관련 계층을 제외한 모든 영역이 애플리케이션 계층
- 서비스의 종류, 동작 방식을 결정하는 계층
- 애플리케이션 **프로그램 간**의 통신을 정의
  - 다른 계층은 **컴퓨터간** 통신을 정의
- 서비스 별로 자신만의 프로토콜을 만들어 사용

### 사용자가 직접 사용하는 애플리케이션 계층 프로토콜

HTTP, POP, SMTP, IMAP, SMB, AFP, FTP, Telnet, SSH

### 사용자가 간접적으로 사용하는 애플리케이션 계층 프로토콜

- OS나 다른 애플리케이션 프로토콜이 간접적으로 사용
- 주로 **인터넷이나 LAN의 원활한 사용**을 위해 사용

| 프로토콜                                               | 동작 방식                                                                                  |
| ------------------------------------------------------ | ------------------------------------------------------------------------------------------ |
| DNS(Domain Name System)                                | 도메인명과 IP 어드레스의 정보를 서로 변환할 때 사용                                        |
| DHCP(Dynamic Host Configuration Protocol)              | LAN 내의 컴퓨터에게 IP 어드레스를 할당할 때 사용한다.                                      |
| SSL/TLS(Secure Sockets Layer/Transport Layer Security) | 통신 데이터를 암호화, 주요 정보를 안전하게 주고 받기위해 사용                              |
| NTP(Network Time Protocol)                             | 네트워크에 연결된 장비들의 시스템 시간을 동기화할 떄 사용                                  |
| LDAP(Lightwight Directory Access Protocol)             | 네트워크에 연결된 자원(사용자, 장비)의 통합 관리에 필요한 디렉터리 서비스를 제공할 때 사용 |

## 2. 웹페이지를 전송하는 HTTP

### 웹페이지가 표시되기까지의 과정

- 정적 웹페이지 응답
- 웹 브라우저가 웹서버로 웹페이지 요청(URL)시, **HTML 파일 형식**으로 응답한다.
- 응답 파일에는 HTML 파일 형식 외에, 웹페이지를 표시하기 위해 필요한 파일(CSS, JS, JPEG..)의 정보도 포함되어있다
- HTML 파일을 렌더링할 때 필요한 파일의 정보를 읽으면 새로운 요청을 보내어 그 파일을 응답받아 통합하여 브라우저에 화면을 출력한다.

### HTTP 메시지

- HTTP 프로토콜을 사용하여 주고 받는 데이터가 HTTP 메시지
- 요청과 응답 두 가지 형태가 있다.
- HTTP의 가장 큰 특징은 무상태성(stateless)이다. 상태 정보를 저장하지 않는 통신 형식을 말한다.

### HTTP 요청과 URL

- HTTP 요청을 할 때, URL(Uniform R Locator) 문자열을 사용
  - URL 형식
    http://www.domain.com/directory/fileName
    스키마(http) - 호스트(www) - 도메인(domain.com) - 디렉토리이름(directory) - 파일이름(filename)
- HTTP 요청 메시지 형식

  | GET /directory/filename HTTP/1.1 | 요청 정보 라인(to) |
  | -------------------------------- | ------------------ |
  | Host: www.domain.com             | 헤더(to)           |
  | 브라우저 관련 정보들             | 헤더(from)         |

  - 요청 정보라인에는 요청방식, 디렉터리/파일 이름, 프로토콜 버전정보가 포함된다.
  - GET 요청의 경우에는 헤더 뒤에 요청내용인 메시지 바디가 없음
  - 어느 서버의 디렉토리의 파일을 찾아달라는 것

### HTTP 응답과 상태코드

- 응답 상태를 나타내기 위해 상태코드가 있다
  - 100번대는 정보
  - 200번대는 성공
  - 300번대는 **경로 전환**
  - 400번대는 에러를 의미
- HTTP 응답 메시지 형식

  | HTTP/1.1 200 OK     | 응답 정보 라인 |
  | ------------------- | -------------- |
  | 파일 관련 내용      | 헤더           |
  | 파일 갱신 날짜 정보 | 헤더           |
  | 파일 content type   | 헤더           |
  | 파일 크기 등등      | 헤더           |
  | (빈줄)              |                |
  | HTTP 파일 문자열    | 바디           |

## 3. 웹서비스와 웹 애플리케이션(HTTP)

### 검색 서비스에서 게시판까지

- 웹 브라우저의 요청 시 **동적**으로 응답할 수 있게 하는 것이 웹 서비스, 웹 애플리케이션이다.
- 웹 서비스에는 쇼핑몰, 검색 서비스, 게시판 등이 있다

### 웹 서비스도 HTTP 메시지로 정보를 교환한다

- 웹 브라우저와 웹 서버간에 웹 서비스를 요청하고 응답받는 것은 양자간 웹 페이지를 요청하고 응답받는 방식과 거의 같다.
- 차이점은 주고 받는 데이터가 정적인 것(미리 생성해둔 html 파일)인지, **웹 서버가 동적으로 생성**해서 제공하는 것인지의 차이

### GET 방식과 POST 방식

- GET
  - 요청 URL에 요청 내용이 포함됨
  - 같은 URL이면 같은 응답이기 때문에 정적인 웹페이지처럼 사용가능
- POST
  - 메시지 바디에 요청 내용이 포함됨
  - GET 방식보다 상대적으로 더 많은 내용을 전달할 수 있음
  - GET 방식처럼 요청 URL에 요청 내용이 노출되지는 않으나, 메시지를 해석할 수 있기 때문에 보안에 유리하지는 않음(https)

### 웹 서비스의 사용성을 높여주는 AJAX

- 요청의 **주체**가 웹 브라우저가 아니라, **JS 프로그램**
- 부분만 갱신되어 자연스러운 상호작용을 할 수 있다.

## 4. 세션을 유지하기 위한 쿠키(HTTP)

- 세션

  - 저장공간. 접속 시작-종료 사이에 상태 정보를 유지하기 위해 사용된다.

- 무상태

  HTTP의 특징 중 하나는 '**무상태(stateless)**'이다. HTTP를 이용한 통신을 할 때 클라이언트와 서버 간 요청과 응답이 한 번씩 오간 후에는 통신이 끊어진다. 인스타그램에 로그인을 하고 댓글을 쓰는 것처럼 서버가 계속해서 클라이언트를 식별해야 할 필요가 있다. 그 때 서버가 여러 요청이 동일한 사용자의 요청(=session을 유지하기위해)임을 식별하기 위해 쿠키를 사용한다.

- 쿠키 생성과 사용, 저장 형태

  - 쿠키는 서버에 첫 요청 시, 서버가 응답 헤더에 `Set-Cookie:` 로 시작하는 문자열을 보낸다. 웹 브라우저는 응답을 읽고 뒷 문자열을 로컬 디스크에 쿠키 형태로 저장한다.
  - 쿠키를 생성한 웹서버에 요청을 보낼 때 웹 브라우저가 자동으로 쿠키를 함께 보낸다.
  - 쿠키는 key:value 형태로 저장된다.

- 쿠키 악용 대비책
  쿠키가 로컬 디스크에 저장되기 때문에 이를 악용할 수 있는데 웹 브라우저 자체에서도 이를 방지할 수 있는 방법을 구현했다.
  1. 쿠키가 생성된 웹서버와 동일한 도메인을 사용하는 웹 사이트에만 쿠키를 같이 보내도록 제한
  2. 쿠키의 유효기한을 설정하고 지난 것은 자동으로 삭제
- 식별 정보

  쿠키는 사용자의 PC에 저장되기 때문에 민감한 정보를 쿠키로 저장해서는 안된다. 민감한 정보는 서버에 저장하고, 동일한 사용자인지 확인하기 위한 세션ID등의 식별 정보만 쿠키로 저장한다.

## 5. 이메일

### 송신과 수신에 서로 다른 프로토콜을 사용한다

- 서버에 메일을 송신할 때 SMTP 사용
- 서버에서 메일을 수신할 떄 POP 사용

### SMTP의 동작 방식

- 상태 정보를 저장하는 stateful이라 종료 명령을 보내기 전까지 통신이 연결되어있음
- 데이터 전송 순서
  - 접속 요청 > 송신자 정보전달 > 수신자 정보 전달 > 메일 정보 전달 > 접속 종료 명령

### 이메일을 수신하는 POP

- 서버에 저장된 메일을 확인하는데 사용
- 메일 관련작업(메일건수, 용량 확인, 메일 삭제)에도 사용
- POP3
- 데이터 전송 순서
  - 접속 요청 > 인증 > 메일 관련 정보 확인 > 메일 데이터 취득 > 종료

### SMTP에도 인증은 필요하다

- POP의 인증 기능 활용 or 외부 네트워크의 SMTP 접근 차단
- SMTP Auth

### 서버에 메일을 보관하는 IMAP

- POP는 메일 수신 시 서버에 저장된 메일을 삭제. 로컬에 저장하기 떄문에 저장공간이 충분해야 오래 저장 가능
- IMAP은 메일을 수신 해도 서버의 메일이 삭제 안됨. 수신할 때마다 다운로드 하는 방식. 저장공간이 충분하지 않은 모바일 기기에서 주로 사용하는 프로토콜

## 6. PC끼리 파일 공유하기

개인 컴퓨터에 공유 디렉터리를 만들어 그곳에 파일을 저장, 공유하는 방식

### 피어 투 피어 통신

- 네트워크에 연결된 컴퓨터가 서로 클라이언트, 서버가 되는 것
- 따로 서버가 필요 없고, 같은 LAN에 접속하기만 하면 쉽게 파일을 공유할 수 있다.
- NAS(Networt Attached Storage)

### 공유할 상대 컴퓨터를 찾는 방법

- 같은 네트워크의 모든 컴퓨터에 자신이 연결되었다는 것을 통보한다. 이후 정보를 받은 컴퓨터가 자신과 통신하는데 필요한 정보를 응답으로 보내어 공유할 상태 컴퓨터에 대한 목록을 가지게 된다.

### 파일 공유 프로토콜은 OS마다 서로 다르다

- Windows - SMB(Server Message Block)
- MAC - AFP(Apple Filling Protocol)
- Linux - NFS(Network File System)
- 최근 다른 OS의 프로토콜도 지원. 간단한 설정으로 파일 공유 가능.

## 7. 파일을 전송하는 FTP

### 서버로 파일을 전송한다

- LAN에서는 파일 공유 같은 더 간단한 방법 있음
- 주로 인터넷에 연결된 원격 서버에 파일을 업로드 할 때 사용
- FTP, Web 서버를 한 대의 컴퓨터에서 구동
  - FTP로 파일 업로드, Web 서버로 브라우저에 응답 가능

### 데이터 커넥션과 컨트롤 커넥션

- 데이터 커넥션 : 파일을 전송하기 위한 연결
- 컨트롤 커넥션 : 명령어를 전송하기 위한 연결
- 파일과 명령어 전송 연결이 분리되어 있기 때문에 파일 전송 중에 명령어를 보내 전송을 중단할 수 있다는 장점이 있음

### 액티브 모드와 패시브 모드

- 방화벽이나 라우터를 사용하는 경우 외부와의 통신을 차단하는 경우가 많다
- FTP 서버에서 클라이언트로 데이터 커넥션을 만드는데 차단되는 경우(액티브 모드), 역방향으로 클라이언트에서 서버로 데이터 커넥션을 만드는 것을 **패시브 모드**라고 한다.

## 8. 원격지의 컴퓨터 제어하기

### 원격지 컴퓨터를 명령어로 제어하기

- Telnet, SSH(Secure SHell)
- 주로 원격 서버를 제어하는데 사용
- CLI와 같은 명령 프롬프트로 제어한다. 프롬프트에 명령어를 작성하면 명령어가 서버로 전송되어 처리 후 결과값을 텍스트로 응답받아 프롬프트에 출력한다. 마치 서버를 직접 사용하는 것같이 느낄 수 있다.

### 원격지 컴퓨터의 데스크톱 제어하기

- 텍스트 형태의 명령어 방식 외에도 **GUI**나 원격 제어 관련 프로토콜을 활용하여 원격 컴퓨터를 제어할 수 있다.
  - Windows 내장 원격 데스크톱은 RDP(Remote Desktop Protocol)
  - VNC은 RFB(Remote FrameBuffer)로 제어
- GUI로 제어하는 경우 마우스, 키보드 제어 정보를 서버에 전달하고 결과 이미지를 응답받기 때문에 이미지 압축기술도 함꼐 사용됨

#### 씬클라이언트

- 한 대의 서버에 여러 개의 가상 OS를 구동하여 저사양 PC로 원격 데스크탑이나 VNC으로 접속하여 서버 자원에 접근하는 방식

## 9. Voice over IP와 영상 스트리밍

### 실시간으로 음성과 동영상을 보내기 위한 기술

- 인터넷 전화에 사용되는 VoIP(Voice Over Internet Protocol) 기술
- UDP
  - 음성 전화보다 동영상이 용량이 크기 때문에 신뢰성보다는(조금 누락되도 괜찮다!) 전송속도가 중요하기에 UDP 사용
- 스트리밍
  - 전송 시 데이터 압축하고 도착하면 나머지 데이터 기다리지 않고 바로 재생하는 기술

### 클라이언트 서버 방식과 조합하기

- 상대 컴퓨터를 찾기 위해 클라이언트-서버 방식으로 네트워크에 연결된 상대 컴퓨터의 디렉터리를 찾고, P2P 방식으로 전환하여 직접 통신하는 하이브리드 방식

### 동영상 공유 서비스가 사용하는 프로토콜

- 동영상 공유에 사용되는 프로토콜이 널리 보편화되지 않아서 통신이 거부되는 경우가 종종 있다. 반면 HTTP는 통신 거부되는 경우가 거의 없기 때문에 동영상 프로토콜에서 사용할 데이터를 HTTP 메시지 안에 넣어 통신하는 기술을 사용.
